# NCBI Gene annotations
NCBI's Entrez Gene database provides many resources, but this repository is
focused on a single file named `gene_info.gz` which is a flatfile containing
all Genes, annotations, and various external references collected into NCBI's
[Gene Portal](http://ncbi.nih.gov/gene)

The file sourced for this analysis is from: `https://ftp.ncbi.nih.gov/gene/DATA/gene_info.gz`

	WARNING: this repo will very likely be force-pushed as we find and
	incorporate older data sets, do not rely on specific commit hashes!

# Why / How
Since the NCBI does not provide a public history, we have reconstructed the
history using crowd-sourced data files (generally found within backups and old
analysis projects). To keep the repository size small and allow the best
resolution for the data available, we have extracted partial datasets from
larger collections and do not commit binary blobs such as gzipped files.

## Processing
The header from this file is saved to `gene_info.header.txt` by itself, all other files have no header present.

Data contents are extracted and grouped into separate files based on the first column (Taxonomy ID).
Each file name contains the Taxonomy ID using the format `gene_info.<tax_id>.txt`

So to re-create the Human `gene_info` data from the 25th of December, 2020, you can use the following sequence:

```console
# Note this date is inclusive
$ git checkout `git rev-list -1 --before="Dec 25 2020" main`
$ cat gene_info.header.txt gene_info.9606.txt | gzip > ~/Homo_sapiens.gene_info.gz
```

Many "single species" files distributed by NCBI actually have a number of
additional Tax IDs, so if you want to confirm checksum you will need to ensure
all of the data is present (and be sure to decompress the gzip snapshots).

```console
$ gunzip -c ~/Homo_sapiens.gene_info.20190828.gz |cut -f 1|uniq
#tax_id
9606
63221
741158

$ git checkout `git rev-list -1 --before="Aug 28 2019" main`

$ cat gene_info.header.txt genes_9k/gene_info.9606.txt genes_63k/gene_info.63221.txt genes_741k/gene_info.741158.txt |gzip >test.gz

$ gunzip -c test.gz |md5sum
9eb67dbb15ed6a37e7b0289cb57075c7  -

$ gunzip -c ~/Homo_sapiens.gene_info.20190828.gz |md5sum
9eb67dbb15ed6a37e7b0289cb57075c7  -
```

We've created a simple script, `reconstruct.sh` to do the above steps for you, using only the date and the subset you're interested in:

```console
$ bash reconstruct.sh 2016-05-25 sets/Homo_sapiens.txt |gzip >test.gz
Checking out best data for 2016-05-25...
Reconstructing file...

$ gunzip -c test.gz |md5sum
8fa43e99fadaa1297b6e7065c35e9332  -

$ gunzip -c ../Homo_sapiens.gene_info.20160525.gz |md5sum
8fa43e99fadaa1297b6e7065c35e9332  -
```

# TODO

  - ~~ Would be nice to save the subset lists so we can recreate `All_Mammalia.gene_info.gz` et al ~~
  - Can we create some scripts that can rebase so that refs can be more stable?

# BUILDING

Source code for data generation is at `https://github.com/joiningdata/data_histories`
Specifically, this repository is generated by the following sequence:

```console
$ cd /path/to/ncbi/archive 

$ bash ~/src/github.com/joiningdata/datasets/ncbi_gene_info/gen.sh

$ git remote add origin git@github.com:joiningdatasets/ncbi_gene_info.git

$ git push -u origin main

```

# CONTRIBUTING

If you have any data files that can fill in gaps in the history of this repository,
please share them and [open a bug report with the link](https://github.com/joiningdatasets/ncbi_gene_info/issues/new)!

# License
Data sourced from NCBI is a product of the US Goverment and thus in the Public
Domain. 

